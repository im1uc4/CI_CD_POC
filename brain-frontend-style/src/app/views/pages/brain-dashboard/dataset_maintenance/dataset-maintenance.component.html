<div class="row">
    <div class="col-sm-10">
        <p style="font-size:1.8rem; font-weight: 600" *ngIf="selectedModel">{{ selectedModel.model_name }} - {{ selectedModel.model_description_header }}</p>                
    </div>        
</div>

<mat-horizontal-stepper [linear]="isLinear" #stepper>
<mat-step [stepControl]="firstFormGroup" editable="false">
    <form [formGroup]="firstFormGroup">
        <ng-template matStepLabel>Select Dataset</ng-template>
         <!--  <mat-form-field> -->
                <kt-portlet>
                        <!-- PORTLET LOADING | Binded to TABLE Datasource -->
                        <!-- See prop => '~/core/_crud/models/data-sources/_base.datasource.ts' (loading$) -->
                        <kt-portlet-header [title]="'Datasets List'" [class]="'kt-portlet__head--lg'" [viewLoading$]="dataSource?.loading$">
                            <ng-container ktPortletTools>
                                <!-- mat-raised-button | Rectangular contained button w/ elevation  -->
                            </ng-container>
                        </kt-portlet-header>
                        <!-- end::Header -->
                    
                        <!-- start::Body (attribute: ktPortletBody) -->
                        <kt-portlet-body>
                            <!-- start::FILTERS & GROUP ACTIONS -->
                            <div class="kt-form kt-margin-b-30">
                                    <!-- start::FILTERS -->
                                <div class="kt-form__filtration">
                                    <div class="row align-items-center">
                                        <div class="col-md-2 kt-margin-bottom-10-mobile">
                                            <mat-form-field class="mat-form-field-fluid">
                                                <input matInput [matDatepicker]="scheduleDateInput" #scheduleDateInput placeholder="Dataset Schedule Date" (dateChange)="DatepickerInput_Event_Schedule($event)">
                                                <mat-datepicker-toggle matSuffix [for]="scheduleDateInput"></mat-datepicker-toggle>
                                                <mat-datepicker #scheduleDateInput></mat-datepicker>                               
                                            </mat-form-field>
                                        </div>
                                        <div class="col-md-2 kt-margin-bottom-10-mobile">
                                                <mat-form-field class="mat-form-field-fluid">
                                                    <input matInput [matDatepicker]="createDateInput" #createDateInput placeholder="Dataset Created Date"  (dateChange)="DatepickerInput_Event_CreateAt($event)">
                                                    <mat-datepicker-toggle matSuffix [for]="createDateInput"></mat-datepicker-toggle>
                                                    <mat-datepicker #createDateInput></mat-datepicker>                               
                                                </mat-form-field>
                                        </div> 
                                        <div class="col-md-2 kt-margin-bottom-10-mobile">
                                                <mat-form-field class="mat-form-field-fluid">
                                                        <mat-select placeholder="Dataset Created By" #runByInput (selectionChange)="runByInput_event($event)">
                                                                <mat-option #runByInput  value=""></mat-option>
                                                                <mat-option #runByInput *ngFor="let elem of dslistResult  | listfilter :'created_by'" [value]="elem.created_by">{{ elem.created_by }}</mat-option>
                                                        </mat-select>
                                                </mat-form-field>
                                        </div>                                              
                                        <div class="col-md-2 kt-margin-bottom-10-mobile">
                                                <mat-form-field class="mat-form-field-fluid">
                                                    <input matInput placeholder="Search user" #searchInput1 placeholder="Search">
                                                    <mat-hint align="start">
                                                        <strong>Search</strong> 'Dataset Name' field
                                                    </mat-hint>
                                                </mat-form-field>
                                        </div>
                                    </div>
                                </div>  
                            </div>                           
                            

                            <!-- end::FILTERS & GROUP ACTIONS -->   
                            <div class="mat-table__wrapper mat-table__wrapper--sub">
                                <mat-table #table
                                    [dataSource]="dataStore_dsList" matSort  
                                    #a_sort="matSort"
                                    matSortActive="createdAt"
                                    matSortDirection="desc"
                                    matSortDisableClear>                
                    
                                    <!-- Table with selection -->                  
                                    <ng-container matColumnDef="select" visible=false>
                                        <mat-header-cell *matHeaderCellDef class="mat-column-checkbox">
                                        </mat-header-cell>
                                        <mat-cell *matCellDef="let row" class="mat-column-checkbox">
                                            <mat-checkbox  (click)="$event.stopPropagation()" (change)="$event ? selection.toggle(row) : null" [checked]="selection.isSelected(row)" formControlName="firstCtrl"  required>
                                            </mat-checkbox>
                                        </mat-cell>
                                    </ng-container>                    
                                    <ng-container matColumnDef="id">
                                        <!-- ATTRIBUTE mat-sort-header  for sorting | https://material.angular.io/components/sort/overview -->
                                        <mat-header-cell *matHeaderCellDef mat-sort-header>ID</mat-header-cell>
                                        <mat-cell *matCellDef="let dslist">{{ dslist.id }}</mat-cell>
                                    </ng-container>
                    
                                    <ng-container matColumnDef="dataset_scheduledatetime">
                                        <mat-header-cell *matHeaderCellDef mat-sort-header>Dataset Schedule Date</mat-header-cell>
                                        <mat-cell [ngStyle]="{'color':selection.isSelected(row) ? 'white': null}"  *matCellDef="let row; let dslist">{{ dslist.dataset_scheduledatetime | date: 'dd MMM yyyy h:mm:ss a' }}</mat-cell>
                                    </ng-container>
                    
                                    <ng-container matColumnDef="dataset_name">
                                        <mat-header-cell *matHeaderCellDef mat-sort-header>Dataset Name</mat-header-cell>
                                                <mat-cell [ngStyle]="{'color':selection.isSelected(row) ? 'white': null}" *matCellDef="let row; let dslist">{{ dslist.dataset_name }}</mat-cell>
                                    </ng-container>
                    
                                    <ng-container matColumnDef="created_by">
                                        <mat-header-cell *matHeaderCellDef mat-sort-header>Dataset Created By</mat-header-cell>
                                        <mat-cell [ngStyle]="{'color':selection.isSelected(row) ? 'white': null}"  *matCellDef="let row; let dslist">{{ dslist.created_by }}</mat-cell>
                                    </ng-container>
                    
                                    <ng-container matColumnDef="createdAt">
                                        <mat-header-cell *matHeaderCellDef mat-sort-header>Dataset Created Date</mat-header-cell>
                                        <mat-cell [ngStyle]="{'color':selection.isSelected(row) ? 'white': null}"  *matCellDef="let row; let dslist">
                                            <span>{{ dslist.createdAt | date: 'dd MMM yyyy h:mm:ss a' }}</span>
                                        </mat-cell>
                                    </ng-container>    
                                    <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                    
                                    <mat-row *matRowDef="let row; columns: displayedColumns"  [ngClass]="{'highlight': selection.isSelected(row)}"  (click)='$event ? clickRow(row): null'></mat-row>
                                </mat-table>
                                <div class="mat-table__message" *ngIf="dataStore_dsList?.data.length===0">No records found</div><!-- Message for empty data  -->
                            </div>
                            <!-- start: BOTTOM -->
                            <div class="mat-table__bottom">
                                <!-- MATERIAL PAGINATOR | Binded to dasources -->
                                <!-- See off.documentations 'https://material.angular.io/components/paginator/overview' -->
                                <mat-paginator [pageSize]="5" [pageSizeOptions]="[5, 10, 15]" [length]="dataStore_dsList?.data.length" [showFirstLastButtons]="true"></mat-paginator>
                            </div>
                            <!-- end: BOTTOM -->  
                        </kt-portlet-body>
                        <!-- end::Body -->
                    </kt-portlet>
                 <!-- </mat-form-field> -->                
              </form>
            </mat-step>
            <mat-step [stepControl]="secondFormGroup">
              <form [formGroup]="secondFormGroup">
                <ng-template matStepLabel><span>View/Edit Dataset & Submit</span></ng-template>
                <div class="row col-md-12">
                    <div class="col-md-11">
                        <p style="font-size:1.8rem; font-weight: 600" *ngIf="selection.hasValue()">{{ dsTitle }}</p>
                        <p *ngIf="selection.hasValue()">Review the dataset and edit any dataset information below if needed.</p>
                    </div>
                    <div class="col-md-1">
                            <button mat-button (click)="$event.stopPropagation(); openDialog()" style="float: right;"><p style="margin: 0px; font-size: 0.8rem">View Roster Rules </p></button>
                    </div>                  
                </div>
                 <div class="row col-md-12">
                    <p>&nbsp;</p>
                 </div>
                 <div class="row col-md-12">
                    <p>&nbsp;</p>
                 </div>
                <div class="row col-md-12">
                    <div class="col-md-12">                  
                        <!--<div class="mat-table__wrapper">-->
                                <kt-dynamic-table
                                    [tableName]="'timewindows'"
                                    [sequenceNum]="1"
                                    [formMode]="'short'"
                                    (validityChanged)="childFormValidity($event,1)"
                                    ></kt-dynamic-table>
                                    <kt-dynamic-table
                                    [tableName]="'services'"
                                    [sequenceNum]="2"
                                    [formMode]="'short'" 
                                    (validityChanged)="childFormValidity($event,3)"                                
                                    ></kt-dynamic-table>
                                <kt-dynamic-table
                                    [tableName]="'resources'"
                                    [sequenceNum]="3"
                                    [formMode]="'short'"
                                    (validityChanged)="childFormValidity($event,2)"
                                    ></kt-dynamic-table>
                            <!--</div>-->
                            <!--<div class="mat-table__wrapper">-->                               
                                <kt-dynamic-table
                                    [tableName]="'tasks'"
                                    [sequenceNum]="4"
                                    [formMode]="'short'" 
                                    (validityChanged)="childFormValidity($event,4)"                                
                                    ></kt-dynamic-table>                                   
                            <!--</div>-->
                            <!--<div class="mat-table__wrapper">-->
                                <kt-dynamic-table
                                    [tableName]="'create_roster'"
                                    [sequenceNum]="5"
                                    [formMode]="'short'" 
                                    (generateOptimisedSchedule)="generateOptimizedSchedule($event,dataSetDataChange)"  
                                    (validityChanged)="childFormValidity($event,5)" 
                                    [proceed]="proceedSubject.asObservable()"                             
                                    ></kt-dynamic-table>
                                   
                            <!--</div>-->
                    </div>            
               </div>
              </form>
            </mat-step>
            <mat-step>
              <ng-template matStepLabel>Verify Roster</ng-template>
               <div class="row col-md-12">
               <p>&nbsp;</p> 
               </div>
               <div class="row col-md-12">  
                    <div class="col-md-10"> 
                    </div>
                    <div class="col-md-2"> 
                        <button mat-button matStepperPrevious class="btn btn-bold btn-label-brand btn-sm" style="float: right;" color="primary" matTooltip="Reconfigure Dataset" type="button"  aria-labelledby="Reconfigure Dataset" style="float: right;"><span>Reconfigure Dataset</span></button>
                    </div>
                </div>
                 <!-- vis.js gantt-chart-component -->
                 <!-- See GanttChartComponent => '~/views/pages/brain-dashboard/gantt_chart/gantt-chart.component.ts -->
                 <gantt-component *ngIf="showGantt"  [JobId]="jobIdString"></gantt-component>
              <div>
              </div>
            </mat-step>
          </mat-horizontal-stepper>  
